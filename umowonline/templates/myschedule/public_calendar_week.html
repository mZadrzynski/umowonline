{% extends "base.html" %}
{% block title %}Kalendarz tygodniowy – {{ calendar_owner.username }}{% endblock %}

{% block content %}

{% load static %}
<head>
    <link rel="stylesheet" type="text/css" href="{% static 'css/myschedule.css' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

</head>

<h2>Kalendarz tygodniowy użytkownika {{ calendar_owner.username }}</h2>

<div>
  <a href="?week={{ week_offset|add:"-1" }}">Poprzedni tydzień</a> |
  <a href="?week={{ week_offset|add:"1" }}">Następny tydzień</a>
</div>


<table class="calendar-table">
  <tr>
    <th>Pon</th><th>Wt</th><th>Śr</th><th>Cz</th><th>Pt</th><th>Sob</th><th>Nd</th>
  </tr>
  <tr>
  {% for day, availabilities in availabilities_by_day_items %}
    <td>
      <div class="calendar-day">{{ day|date:"d-m-Y" }}</div>
      {% if availabilities %}
        {% for info in availabilities %}
          <div class="availability-item">
            <div class="availability-title">{{ info.availability.title }}</div>
            <div class="availability-time">
              {{ info.availability.start_time|time:"H:i" }} – {{ info.availability.end_time|time:"H:i" }}
            </div>
            {% if info.busy_slots %}
              <div class="busy-slots">
                <div class="busy-slots-label">⚠️ Zajęte sloty:</div>
                {% for start, end in info.busy_slots %}
                  <span class="busy-slot">{{ start|time:"H:i" }}-{{ end|time:"H:i" }}</span>
                {% endfor %}
              </div>
            {% endif %}
            <div class="booking-actions">
              <a href="{% url 'book_availability' info.availability.id %}"
                 class="book-link">
                ✅ Zarezerwuj
              </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="no-availability">Brak dostępności</div>
      {% endif %}
    </td>
  {% endfor %}
  </tr>
</table>
{% endblock %}
