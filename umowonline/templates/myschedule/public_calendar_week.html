{% extends "base.html" %}
{% block title %}Kalendarz tygodniowy â€“ {{ calendar_owner.username }}{% endblock %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/calendar.css' %}">

<div class="calendar-container">
    <div class="calendar-header">
        <h2>Kalendarz tygodniowy uÅ¼ytkownika {{ calendar_owner.username }}</h2>
        <div class="month-nav">
            <a href="?week={{ week_offset|add:-1 }}" class="nav-btn">
                Â« Poprzedni tydzieÅ„
            </a>
            <span>{{ selected_week|date:"d.m.Y" }}</span>
            <a href="?week={{ week_offset|add:1 }}" class="nav-btn">
                NastÄ™pny tydzieÅ„ Â»
            </a>
        </div>
    </div>

    <table class="calendar-table">
        <thead>
            <tr>
                <th>Pon</th>
                <th>Wt</th>
                <th>Åšr</th>
                <th>Cz</th>
                <th>Pt</th>
                <th>Sob</th>
                <th>Nd</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                {% for day, availabilities in availabilities_by_day_items %}
                <td>
                    <div class="cell-content">
                        <div class="calendar-day">
                            {{ day|date:"d" }}
                        </div>
                        
                        {% if availabilities %}
                            {% for info in availabilities %}
                            <div class="availability-item">
                                <div class="availability-title">
                                    {% if info.availability.title %}
                                        {{ info.availability.title }}
                                    {% else %}
                                        DostÄ™pnoÅ›Ä‡
                                    {% endif %}
                                </div>
                                <div class="availability-time">
                                    {{ info.availability.start_time|time:"H:i" }} - {{ info.availability.end_time|time:"H:i" }}
                                </div>

                                <!-- ZajÄ™te sloty (tylko aktywne rezerwacje) -->
                                {% if info.busy_slots %}
                                    <div class="busy-slots">
                                        <div class="busy-slots-label">ZajÄ™te:</div>
                                        {% for start, end in info.busy_slots %}
                                        <span class="busy-slot">
                                            {{ start|time:"H:i" }}-{{ end|time:"H:i" }}
                                        </span>
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                <!-- Przycisk rezerwacji -->
                                <div class="booking-actions">
                                    <a href="{% url 'book_availability' info.availability.id %}" 
                                       class="book-link {% if info.busy_slots %}partial{% else %}available{% endif %}">
                                        {% if info.busy_slots %}
                                            ðŸ“… Zarezerwuj pozostaÅ‚y czas
                                        {% else %}
                                            âœ… Zarezerwuj
                                        {% endif %}
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-availability">
                                Brak dostÄ™pnoÅ›ci
                            </div>
                        {% endif %}
                    </div>
                </td>
                {% endfor %}
            </tr>
        </tbody>
    </table>
</div>

{% endblock %}