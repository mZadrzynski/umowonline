{% extends "base.html" %}
{% block title %}Kalendarz – {{ calendar_owner.username }}{% endblock %}
{% block content %}
{% load static %}
<head>
    <link rel="stylesheet" href="{% static 'css/calendar_public.css' %}">
</head>
<div class="calendar-container">
    <!-- Header -->
    <div class="calendar-header">
        <h1 class="calendar-title">
            <i class="fas fa-calendar-alt"></i>
            Kalendarz {{ calendar_owner.username }}
        </h1>
        <p class="calendar-subtitle">Wybierz dogodny termin dla siebie</p>
    </div>
    
    <!-- Navigation -->
    <div class="week-navigation">
        <a href="?week={{ week_offset|add:'-1' }}" class="nav-btn prev-btn">
            <i class="fas fa-chevron-left"></i> << Poprzedni tydzień
        </a>
        <div class="current-week">
            <i class="fas fa-calendar-week"></i>
            {{ selected_week|date:"m.Y" }}
        </div>
        <a href="?week={{ week_offset|add:'1' }}" class="nav-btn next-btn">
            Następny tydzień >> <i class="fas fa-chevron-right"></i>
        </a>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-grid">
        {% for day, availabilities in availabilities_by_day_items %}
   
        <div class="day-column">
        
            <!-- Day Header -->
            <div class="day-header">
                <div class="day-name">
                {% with day|date:"D" as day_short %}
                {% if day_short == "Mon" %}Pon{% elif day_short == "Tue" %}Wt{% elif day_short == "Wed" %}Śr{% elif day_short == "Thu" %}Czw{% elif day_short == "Fri" %}Pt{% elif day_short == "Sat" %}Sob{% elif day_short == "Sun" %}Niedz{% endif %}
                {% endwith %}
                </div>
                <div class="day-date">{{ day|date:"d.m" }}</div>
            </div>
            
            <!-- Day Content -->
            <div class="day-content">
                {% if availabilities %}
                    {% for info in availabilities %}
                    <div class="availability-card">
                        {% if info.availability.title %}
                        <div class="availability-title">
                            <i class="fas fa-tag"></i>
                            {{ info.availability.title }}
                        </div>
                        {% endif %}
                        
                        <!-- Free Time Slots -->
                        {% if info.free_slots %}
                        <div class="time-slots">
                            <div class="slots-label">
                                <i class="fas fa-clock text-success"></i>
                                Dostępne terminy:
                            </div>
                            <div class="slots-container">
                                {% for start, end in info.free_slots %}
                                <span class="time-slot free">{{ start }}–{{ end }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% else %}
                        <div class="no-slots">
                            <i class="fas fa-times-circle text-muted"></i>
                            Brak wolnych terminów
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-availability">
                        <i class="fas fa-moon"></i>
                        <p>Dzień wolny</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- Book Button (zawsze na dole) -->
            <div class="day-footer">
                {% if availabilities %}
                    {% for info in availabilities %}
                        {% if info.free_slots %}
                        <a href="{% url 'book_availability' info.availability.id %}" 
                           class="book-btn available">
                            <i class="fas fa-calendar-plus"></i>
                            Zarezerwuj wizytę
                        </a>
                        {% else %}
                        <button class="book-btn unavailable" disabled>
                            <i class="fas fa-ban"></i>
                            Brak miejsc
                        </button>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <button class="book-btn unavailable" disabled>
                        <i class="fas fa-moon"></i>
                        Dzień wolny
                    </button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>



{% endblock %}
