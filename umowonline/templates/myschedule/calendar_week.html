{% extends "myschedule/calendar_sidemenu.html" %}

{% block title %}Kalendarz tygodniowy{% endblock %}

{% block calendar %}
{% load static %}
<head>
    <link rel="stylesheet" type="text/css" href="{% static 'css/myschedule.css' %}">
    <link rel="stylesheet" href="{% static 'css/calendar.css' %}">
</head>
<h2>Kalendarz tygodniowy uÅ¼ytkownika {{ request.user.username }}</h2>

<div>
  <a href="?week={{ week_offset|add:"-1" }}">Poprzedni tydzieÅ„</a> |
  <a href="?week={{ week_offset|add:"1" }}">NastÄ™pny tydzieÅ„</a>
</div>

<table class="calendar-table">
  <tr>
    <th>Pon</th><th>Wt</th><th>Åšr</th><th>Cz</th><th>Pt</th><th>Sob</th><th>Nd</th>
  </tr>
  <tr>
  {% for day, availabilities in availabilities_by_day_items %}
    <td>
      <div class="calendar-day">{{ day|date:"d-m-Y" }}</div>
      {% if availabilities %}
        {% for info in availabilities %}


        <div class="cell-content">
          <div class="availability-item">
            <div class="availability-title">{{ info.availability.title }}</div>
            <div class="availability-time">{{ info.availability.start_time|time:"H:i" }} - {{ info.availability.end_time|time:"H:i" }}
            
            <!-- POPRAWKA: uÅ¼yj info.availability.id zamiast availability.id -->
            <a href="{% url 'delete_availability' info.availability.id %}" 
              class="btn btn-sm btn-outline-danger" 
              title="UsuÅ„ dostÄ™pnoÅ›Ä‡"
              onclick="return confirm('Czy na pewno chcesz usunÄ…Ä‡ tÄ™ dostÄ™pnoÅ›Ä‡?')">
              <i class="fas fa-trash"></i>
            </a>
            </div>
            {% if info.busy_slots %}
              <div class="busy-slots">
                <div class="busy-slots-label">Zarezerwowane wizyty</div>
                {% for start, end in info.busy_slots %}
                  <span class="busy-slot">{{ start|time:"H:i" }}-{{ end|time:"H:i" }}</span><br>
                {% endfor %}
              </div>
            {% endif %}
            
            <div class="booking-actions">
              {% if info.busy_slots %}
                <a href="{% url 'book_availability' info.availability.id %}" class="book-link partial">ðŸ“… Zarezerwuj pozostaÅ‚y czas</a>
              {% else %}
                <a href="{% url 'book_availability' info.availability.id %}" class="book-link available">âœ… Zarezerwuj</a>
              {% endif %}
            </div>
          </div>
        {% endfor %}
        
      {% else %}
        <div class="no-availability">Brak dostÄ™pnoÅ›ci</div>
      {% endif %}
        </div>

    </td>
  {% endfor %}
  </tr>
</table>


  <h2>UdostÄ™pnij kalendarz</h2>

  
  <div class="share-calendar">
    <p>UdostÄ™pnij swÃ³j kalendarz innym, kopiujÄ…c poniÅ¼szy adres:</p>
    <input
      type="text"
      class="form-control"
      readonly
      value="{{ public_calendar_url }}"
    >
  </div>
<h3>Twoja dostÄ™pnoÅ›Ä‡ w tym tygodniu:</h3>
<ul>
<h3>Twoja dostÄ™pnoÅ›Ä‡:</h3>
<ul>
  {% for a in availabilities %}
    <li>{{ a.date }}: {{ a.start_time }} - {{ a.end_time }}</li>
  {% empty %}
    <li>Brak dostÄ™pnoÅ›ci</li>
  {% endfor %}
</ul>
  
</ul>


{% endblock %}